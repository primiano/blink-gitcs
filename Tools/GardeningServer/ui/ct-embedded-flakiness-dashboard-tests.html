<!--
Copyright 2014 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="ct-embedded-flakiness-dashboard.html">

<script>
(function() {

module("ct-embedded-flakiness-dashboard");

asyncTest("url", 1, function() {
  var failure = new CTFailure('foo_tests', 'foo/bar.html');
  var tree = "blink";
  var embeddedFlakinessDashboard = document.createElement('ct-embedded-flakiness-dashboard');

  embeddedFlakinessDashboard.test = failure;
  embeddedFlakinessDashboard.tree = tree;

  requestAnimationFrame(function() {
    var iframe = embeddedFlakinessDashboard.shadowRoot.querySelector('#iframe');
    equal(iframe.src, failure.embeddedFlakinessDashboardURL(tree));
    start();
  });
});

asyncTest("heightChanged", 1, function() {
  var embeddedFlakinessDashboard = document.createElement('ct-embedded-flakiness-dashboard');

  function finishTest() {
    window.removeEventListener('message', finishTest);
    var iframe = embeddedFlakinessDashboard.shadowRoot.querySelector('#iframe');
    equal(iframe.style.height, "100px");
    start();
  }
  window.addEventListener('message', finishTest);

  requestAnimationFrame(function() {
    window.postMessage({command: 'heightChanged', height: "100"}, '*');
  });
});

})()
</script>

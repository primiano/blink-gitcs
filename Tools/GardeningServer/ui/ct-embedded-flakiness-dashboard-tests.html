<!--
Copyright 2014 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="ct-embedded-flakiness-dashboard.html">

<script>
(function() {

module("ct-embedded-flakiness-dashboard");

asyncTest("url", 1, function() {
  var oldUrlForEmbeddedFlakinessDashboard = ui.urlForEmbeddedFlakinessDashboard;
  var reset = function() {
    ui.urlForEmbeddedFlakinessDashboard = oldUrlForEmbeddedFlakinessDashboard;
  }

  try {
    ui.urlForEmbeddedFlakinessDashboard = function(test, step, tree) { return "about:blank#" + test + step + tree; }
    var embeddedFlakinessDashboard = document.createElement('ct-embedded-flakiness-dashboard');
    var testName = "foo/bar.html";
    var step = "foo_tests";
    var tree = "blink";
    embeddedFlakinessDashboard.test = {
      testName: testName,
      step: step,
    };
    embeddedFlakinessDashboard.tree = tree;

    requestAnimationFrame(function() {
      var iframe = embeddedFlakinessDashboard.shadowRoot.querySelector('#iframe');
      equal(iframe.src, ui.urlForEmbeddedFlakinessDashboard(testName, step, tree));
      reset();
      start();
    });
  } catch (e) {
    reset();
  }
});

asyncTest("heightChanged", 1, function() {
  var embeddedFlakinessDashboard = document.createElement('ct-embedded-flakiness-dashboard');

  function finishTest() {
    window.removeEventListener('message', finishTest);
    var iframe = embeddedFlakinessDashboard.shadowRoot.querySelector('#iframe');
    equal(iframe.style.height, "100px");
    start();
  }
  window.addEventListener('message', finishTest);

  requestAnimationFrame(function() {
    window.postMessage({command: 'heightChanged', height: "100"}, '*');
  });
});

})()
</script>

<!--
Copyright 2014 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<polymer-element name="ct-failure-grouper" attributes="failures groups">
  <script>
    Polymer({
      failures: [],
      groups: [],

      failureComparator: function(a, b) {
        return a.testName < b.testName;
      },

      failuresChanged: function() {
        var map = {};
        for (var i = 0; i < this.failures.length; ++i) {
          var failureAnalysis = this.failures[i];
          var key = failureAnalysis.newestPassingRevision + "+" + failureAnalysis.oldestFailingRevision;
          if (!(key in map))
            map[key] = [];
          map[key].push(failureAnalysis);
        }

        this.groups = [];
        var keys = Object.getOwnPropertyNames(map).sort();
        for (var i = 0; i < keys.length; ++i) {
          var key = keys[i];
          this.groups[i] = map[key].sort(this.failureComparator.bind(this));
        }
      },
    });
  </script>
</polymer-element>

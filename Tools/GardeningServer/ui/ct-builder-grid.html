<!--
Copyright 2014 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="ct-builder.html">

<polymer-element name="ct-builder-grid" attributes="failures">
  <template>
    <template repeat="{{ builder in _builders | _keys }}">
      <template repeat="{{ masterUrl in _builders[builder] | _keys }}">
        <ct-builder builder="{{ builder }}" masterUrl="{{ masterUrl }}"></ct-builder>
      </template>
    </template>
  </template>
  <script>
    Polymer({
      failures: null,
      _builders: {},

      _keys: function(obj) {
        return Object.keys(obj).sort();
      },

      failuresChanged: function() {
        this._builders = {};
        this.failures.forEach(function(failure) {
          var results = failure.resultNodesByBuilder;
          Object.keys(results, (function(builder, result) {
            if (!this._builders[builder])
              this._builders[builder] = {};
            this._builders[builder][result.masterUrl] = 1;
          }).bind(this));
        }, this);
      },
    });
  </script>
</polymer-element>

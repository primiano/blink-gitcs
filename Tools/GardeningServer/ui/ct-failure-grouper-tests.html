<!--
Copyright 2014 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="ct-failure-grouper.html">

<script>
(function () {

module("ct-failure-grouper");

var kExampleFailures = [{
    "testName": "http/tests/xmlhttprequest/access-control-basic-allow-preflight-cache-invalidation-by-method.html",
    "resultNodesByBuilder": {
        "WebKit XP": {
            "expected": "PASS",
            "is_unexpected": true,
            "actual": "TEXT",
            "time": 0.7
        }
    },
    "oldestFailingRevision": 177165,
    "newestPassingRevision": 177165
}, {
    "testName": "http/tests/websocket/workers/close-code-and-reason.html",
    "resultNodesByBuilder": {
        "WebKit Mac10.7": {
            "expected": "PASS",
            "is_unexpected": true,
            "actual": "TIMEOUT",
            "time": 6
        }
    },
    "oldestFailingRevision": 177164,
    "newestPassingRevision": 177164
}, {
    "testName": "plugins/gesture-events-scrolled.html",
    "resultNodesByBuilder": {
        "WebKit Win7 (dbg)": {
            "expected": "PASS",
            "is_unexpected": true,
            "actual": "CRASH",
            "time": 0.9
        },
        "WebKit Mac10.6 (dbg)": {
            "expected": "PASS",
            "is_unexpected": true,
            "actual": "CRASH",
            "has_stderr": true,
            "time": 1.8
        },
        "WebKit Mac10.7 (dbg)": {
            "expected": "PASS",
            "is_unexpected": true,
            "actual": "CRASH",
            "has_stderr": true,
            "time": 3.2
        }
    },
    "oldestFailingRevision": 177164,
    "newestPassingRevision": 177165
}, {
    "testName": "plugins/transformed-events.html",
    "resultNodesByBuilder": {
        "WebKit Win7 (dbg)": {
            "expected": "PASS",
            "is_unexpected": true,
            "actual": "CRASH",
            "time": 0.6
        },
        "WebKit Mac10.6 (dbg)": {
            "expected": "PASS",
            "is_unexpected": true,
            "actual": "CRASH",
            "has_stderr": true,
            "time": 1.4
        },
        "WebKit Mac10.7 (dbg)": {
            "expected": "PASS",
            "is_unexpected": true,
            "actual": "CRASH",
            "has_stderr": true,
            "time": 3
        }
    },
    "oldestFailingRevision": 177164,
    "newestPassingRevision": 177165
}, {
    "testName": "plugins/gesture-events.html",
    "resultNodesByBuilder": {
        "WebKit Win7 (dbg)": {
            "expected": "PASS",
            "is_unexpected": true,
            "actual": "CRASH",
            "time": 1.7
        },
        "WebKit Mac10.6 (dbg)": {
            "expected": "PASS",
            "is_unexpected": true,
            "actual": "CRASH",
            "has_stderr": true,
            "time": 2.5
        },
        "WebKit Mac10.7 (dbg)": {
            "expected": "PASS",
            "is_unexpected": true,
            "actual": "CRASH",
            "has_stderr": true,
            "time": 3.4
        }
    },
    "oldestFailingRevision": 177164,
    "newestPassingRevision": 177165
}, {
    "testName": "inspector/console/console-viewport-selection.html",
    "resultNodesByBuilder": {
        "WebKit Linux (dbg)": {
            "expected": "SLOW",
            "is_unexpected": true,
            "actual": "TEXT",
            "bugs": ["webkit.org/b/90488"],
            "time": 5.9
        },
        "WebKit Mac10.6 (dbg)": {
            "actual": "TEXT",
            "time": 6.5,
            "bugs": ["webkit.org/b/90488"],
            "is_unexpected": true,
            "expected": "SLOW",
            "has_stderr": true
        }
    },
    "oldestFailingRevision": 177164,
    "newestPassingRevision": 177165
}, {
    "testName": "svg/custom/foreign-object-skew.svg",
    "resultNodesByBuilder": {
        "WebKit Mac10.6 (dbg)": {
            "expected": "PASS",
            "is_unexpected": true,
            "actual": "IMAGE",
            "time": 0.9
        }
    },
    "oldestFailingRevision": 177164,
    "newestPassingRevision": 177164
}];

asyncTest("basic", 11, function() {
  var grouper = document.createElement('ct-failure-grouper');

  grouper.failures = kExampleFailures;

  Platform.endOfMicrotask(function() {
    var groups = grouper.groups;
    equal(groups.length, 3);

    equal(groups[0].length, 2);
    equal(groups[0][0].testName, 'svg/custom/foreign-object-skew.svg');
    equal(groups[0][1].testName, 'http/tests/websocket/workers/close-code-and-reason.html');

    equal(groups[1].length, 4);
    equal(groups[1][0].testName, 'plugins/transformed-events.html');
    equal(groups[1][1].testName, 'plugins/gesture-events.html');
    equal(groups[1][2].testName, 'plugins/gesture-events-scrolled.html');
    equal(groups[1][3].testName, 'inspector/console/console-viewport-selection.html');

    equal(groups[2].length, 1);
    equal(groups[2][0].testName, 'http/tests/xmlhttprequest/access-control-basic-allow-preflight-cache-invalidation-by-method.html');

    start();
  });
});

})()
</script>

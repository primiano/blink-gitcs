<!--
Copyright 2014 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="../model/ct-failure.html">
<link rel="import" href="ct-test-list.html">

<link rel="import" href="../model/ct-failure.html">

<script>
(function () {

var kExampleTests = [
  new CTFailure("foo_step", "plugins/gesture-events-scrolled.html", {}, 177164, 177165);
  new CTFailure("foo_step", "plugins/transformed-events.html", {}, 177164, 177165);
  new CTFailure("foo_step", "plugins/gesture-events.html", {}, 177164, 177165);
];

var kExampleTestsChromium = [
  new CTFailure("browser_tests", "SomeTest.SubTest1", {}, 177164, 177165);
  new CTFailure("browser_tests", "SomeTest.SubTest2", {}, 177164, 177165);
];

var kExampleTestsBlink = [
  new CTFailure("webkit_tests", "fast/events/foo.html", {}, 177164, 177165);
  new CTFailure("webkit_tests", "fast/events/bar.html", {}, 177164, 177165);
];

module("ct-test-list");

asyncTest("basic", 4, function() {
  var list = document.createElement('ct-test-list');

  list.tests = kExampleFailures;
  list.tree = 'blink';

  setTimeout(function() {
    var tests = list.shadowRoot.querySelectorAll('a');
    equal(tests.length, 3);
    equal(tests[0].href, 'http://test-results.appspot.com/dashboards/flakiness_dashboard.html#group=@ToT%20Blink&tests=plugins%2Fgesture-events-scrolled.html&testType=foo_step');
    equal(tests[1].href, 'http://test-results.appspot.com/dashboards/flakiness_dashboard.html#group=@ToT%20Blink&tests=plugins%2Ftransformed-events.html&testType=foo_step');
    equal(tests[2].href, 'http://test-results.appspot.com/dashboards/flakiness_dashboard.html#group=@ToT%20Blink&tests=plugins%2Fgesture-events.html&testType=foo_step');

    start();
  });
});

asyncTest("groupingChromium", 2, function() {
  var list = document.createElement('ct-test-list');

  list.tests = kExampleTestsChromium;
  list.tree = 'chromium';

  setTimeout(function() {
    var tests = list.shadowRoot.querySelectorAll('a');
    equal(tests.length, 0);
    var icons = list.shadowRoot.querySelectorAll('paper-icon-button');
    equal(icons.length, 1);

    start();
  });
});

asyncTest("groupingBlink", 2, function() {
  var list = document.createElement('ct-test-list');

  list.tests = kExampleTestsBlink;
  list.tree = 'blink';

  setTimeout(function() {
    var tests = list.shadowRoot.querySelectorAll('a');
    equal(tests.length, 0);
    var icons = list.shadowRoot.querySelectorAll('paper-icon-button');
    equal(icons.length, 1);

    start();
  });
});

})()
</script>

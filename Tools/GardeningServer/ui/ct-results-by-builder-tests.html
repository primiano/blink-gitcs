<!--
Copyright 2014 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="ct-results-by-builder.html">

<script>
(function () {

var kExampleFailure = {
    "testName": "inspector/console/console-viewport-selection.html",
    "resultNodesByBuilder": {
        "WebKit Mac10.6 (dbg)": {
            "actual": "IMAGE",
        },
        "WebKit Linux (dbg)": {
            "actual": "TEXT",
        },
    },
    "oldestFailingRevision": 177164,
    "newestPassingRevision": 177165,
};

module("ct-results-by-builder");

asyncTest("basic", 9, function() {
  // FIXME: Remove this override when ct-results-detail is fixed to not use
  // results.fetchResultsURLs.
  var oldFetchResultsURLs = results.fetchResultsURLs;
  results.fetchResultsURLs = function() { return Promise.resolve([]); };

  var resultsByBuilder = document.createElement('ct-results-by-builder');
  resultsByBuilder.failure = kExampleFailure;

  requestAnimationFrame(function() {
    var tabs = resultsByBuilder.shadowRoot.querySelectorAll('paper-tab');
    equal(tabs.length, 2);
    equal(tabs[0].textContent, 'Linux (dbg)');
    equal(tabs[1].textContent, 'Mac10.6 (dbg)');

    var detail = resultsByBuilder.shadowRoot.querySelectorAll('ct-results-detail');
    equal(detail.length, 1);
    equal(detail[0].failure.testName, 'inspector/console/console-viewport-selection.html');
    equal(detail[0].builder, 'WebKit Linux (dbg)');

    resultsByBuilder.shadowRoot.querySelector('paper-tabs').selected = 1;

    requestAnimationFrame(function() {
      results.fetchResultsURLs = oldFetchResultsURLs;

      var detail = resultsByBuilder.shadowRoot.querySelectorAll('ct-results-detail');
      equal(detail.length, 1);
      equal(detail[0].failure.testName, 'inspector/console/console-viewport-selection.html');
      equal(detail[0].builder, 'WebKit Mac10.6 (dbg)');

      start();
    });
  });
});

})()
</script>

<!--
Copyright 2014 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="ct-builder-list.html">
<link rel="import" href="ct-commit-list.html">

<script>
function CTSheriffFailureGroupData(failures, commitList) {
  this.failures = failures;
  this.commitList = commitList;
  this.builderList = new CTBuilderList(failures);
  this.category = 'sheriff';
};

CTSheriffFailureGroupData.prototype.getAnnotations = function() {
  return this.failures.map(function(failure) {
    return failure.annotations();
  }).flatten();
};

CTSheriffFailureGroupData.prototype.dataToExamine = function() {
  return {
    'failures': this.failures,
    'commitList': this.commitList
  }
};

CTSheriffFailureGroupData.prototype.failureKeys = function() {
  return this.failures.map(function(failure) {
    return failure.keys();
  }).flatten();
};

CTSheriffFailureGroupData.prototype.failedOnce = function() {
  var totalFailures = 0;
  for (var i = 0; i < this.failures.length; i++) {
    var resultNodes = this.failures[i].resultNodesByBuilder;
    for (var r in resultNodes) {
      totalFailures += resultNodes[r].failingBuildCount;
      if (totalFailures > 1)
        return false;
    }
  }
  return totalFailures == 1;
};
</script>

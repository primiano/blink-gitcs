<!DOCTYPE HTML>
<script src="/js-test-resources/js-test.js"></script>
<script>
description("Tests that the order of setting the src of an image element and its crossOrigin attribute doesn't matter");
window.jsTestIsAsync = true;

// Resource returns a 100x100 image if Origin: is present, a 200x200 one if not.
var testImageURL = "http://127.0.0.1:8000/resources/origin.php";
var successWidth = 100;

function checkIfDone() {
    if ("loaded" in img1 && "loaded" in img2)
        finishJSTest();
}

function createImage() {
    var img = new Image();
    img.onload = function () {
        (img.width == successWidth ? testPassed : testFailed)("Origin: present in request.");
        img.loaded = true;
        checkIfDone();
    }
    return img;
}

var img1 = createImage();
img1.src = testImageURL + "?1";
img1.crossOrigin = "anonymous";

var img2 = createImage();
img2.crossOrigin = "anonymous";
img2.src = testImageURL + "?2";
</script>

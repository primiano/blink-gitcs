<!DOCTYPE html>
<html>
<head>
<script src="../../js-test-resources/js-test.js"></script>
</head>
<body>
<script type="text/javascript">
description("Check that exact matching is used when comparing a request's originating url and the value provided by Access-Control-Allow-Origin.");

var baseUrl = "http://127.0.0.1:8000/xmlhttprequest/resources/access-control-allow-lists.php";

function generateURL(origin)
{
    if (Array.isArray(origin))
        return baseUrl + "?origins=" + origin.map(encodeURIComponent).join(",");
    else
        return baseUrl + "?origin=" + encodeURIComponent(origin);
}

function shouldPass(origin) {
    debug("Should allow origin: '" + origin + "'");
    xhr = new XMLHttpRequest();
    xhr.open('GET', generateURL(origin), false);
    shouldBeUndefined("xhr.send(null)");
}

function shouldFail(origin) {
    debug("Should disallow origin: '" + origin + "'");
    xhr = new XMLHttpRequest();
    xhr.open('GET', generateURL(origin), false);
    shouldThrow("xhr.send(null)");
}

var thisOrigin = location.protocol + "//" + location.host;

shouldPass("*");
shouldPass(" *  ");
shouldPass("	*");
shouldPass(thisOrigin);
shouldPass(" " + thisOrigin);
shouldPass(" " + thisOrigin + "   	 ");
shouldPass("	" + thisOrigin);
shouldFail(location.protocol + "//www2." + location.host);
shouldFail("//" + location.host);
shouldFail("://" + location.host);
shouldFail("ftp://" + location.host);
shouldFail("http:://" + location.host);
shouldFail("http:/" + location.host);
shouldFail("http:" + location.host);
shouldFail(location.host);
shouldFail(thisOrigin + "?");
shouldFail(thisOrigin + "/");
shouldFail(thisOrigin + " /");
shouldFail(thisOrigin + "#");
shouldFail(thisOrigin + "%23");
shouldFail(thisOrigin + ":80");
shouldFail(thisOrigin + ", *");
//shouldFail(thisOrigin + "\0"); // Doesn't fail on Linux. See http://wkbug.com/88688 and http://wkbug.com/88139
shouldFail(thisOrigin.toUpperCase());
shouldFail(location.protocol.toUpperCase() + "//" + location.host);
shouldFail("-");
shouldFail("**");
shouldFail("\0*");
//shouldFail("*\0"); // Doesn't fail on Linux. http://wkbug.com/88688 and http://wkbug.com/88139
shouldFail("'*'");
shouldFail('"*"');
shouldFail("* *");
shouldFail("*" + location.protocol + "//" + "*");
shouldFail("*" + thisOrigin);
shouldFail("* " + thisOrigin);
shouldFail("*, " + thisOrigin);
shouldFail("\0" + thisOrigin);
shouldFail("null " + thisOrigin);
shouldFail("http://example.net");
shouldFail("http://example.net " + thisOrigin);
shouldFail("http://example.net, " + thisOrigin);
shouldFail(["http://example.net", thisOrigin]);
shouldFail([thisOrigin, thisOrigin]);
shouldFail("null");
shouldFail("");
shouldFail(location.href);
shouldFail(location.href.replace(/\/[^\/]*$/, "/"));
shouldFail(location.href.replace(location.hostname, "localhost"));

</script>
</body>
</html>

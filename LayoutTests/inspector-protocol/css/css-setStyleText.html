<html>
<head>
<style>
body {
  color: green;
}
</style>
<script type="text/javascript" src="../../http/tests/inspector-protocol/resources/protocol-test.js"></script>
<script>
function test()
{
    InspectorTest.eventHandler["CSS.styleSheetAdded"] = styleSheetAdded;
    InspectorTest.sendCommand("CSS.enable", {}, null);

    var styleId;
    function styleSheetAdded(msg)
    {
        var header = msg.params.header;
        if (header.origin !== "regular")
            return;
        delete InspectorTest.eventHandler["CSS.styleSheetAdded"];
        styleId = { "styleSheetId": header.styleSheetId, "ordinal": 0 };
        InspectorTest.sendCommand("CSS.setStyleText", { "styleId": styleId, "text": "color: red;" }, onTextSet);
    }

    function onTextSet(msg) {
        if (msg.error) {
            InspectorTest.log(JSON.stringify(msg.error));
            InspectorTest.completeTest();
            return;
        }
        InspectorTest.log("New cssText:");
        InspectorTest.log(msg.result.style.cssText);
        InspectorTest.sendCommand("DOM.undo", {}, onUndo);
    }

    function onUndo() {
        InspectorTest.sendCommand("CSS.getStyleSheetText", { "styleSheetId": styleId.styleSheetId }, onUndoneText);
        function onUndoneText(msg)
        {
            if (msg.error) {
                InspectorTest.log(msg.error.message);
                InspectorTest.completeTest();
                return;
            }
            InspectorTest.log("StyleSheetText after undo:");
            InspectorTest.log(msg.result.text);
            InspectorTest.sendCommand("DOM.redo", {}, onRedo);
        }
    }

    function onRedo() {
        InspectorTest.sendCommand("CSS.getStyleSheetText", { "styleSheetId": styleId.styleSheetId }, onRedoneText);
        function onRedoneText(msg)
        {
            if (msg.error) {
                InspectorTest.log(msg.error.message);
                InspectorTest.completeTest();
                return;
            }
            InspectorTest.log("StyleSheetText after redo:");
            InspectorTest.log(msg.result.text);
            InspectorTest.completeTest();
        }
    }
}
</script>
</head>
<body onLoad="runTest();">
</body>
</html>

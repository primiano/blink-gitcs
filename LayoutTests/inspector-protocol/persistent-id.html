<html>
<head>
<script type="text/javascript" src="../http/tests/inspector-protocol/resources/protocol-test.js"></script>
<script>
var aGlobalObject = {};

function test()
{

    InspectorTest.sendCommand("Runtime.evaluate", { "expression": "aGlobalObject" }, didEvaluate1.bind(this));

    function didEvaluate1(messageObject)
    {
        var objectId = messageObject.result.result.objectId;
        InspectorTest.sendCommand("Runtime.evaluate", { "expression": "aGlobalObject" }, didEvaluate2.bind(this, objectId));
    }

    function didEvaluate2(expectedObjectId, messageObject)
    {
        var objectId = messageObject.result.result.objectId;
        if (expectedObjectId === objectId)
            InspectorTest.log("SUCCESS: evaluated to an object with same id");
        else {
            InspectorTest.log("FAIL: object ids are different, expected " + expectedObjectId + " found " + objectId);
            return InspectorTest.completeTest();
        }
        InspectorTest.sendCommand("Runtime.releaseObject", { "objectId": objectId }, didReleaseObjectId.bind(this, objectId));
    }

    function didReleaseObjectId(releasedObjectId, messageObject)
    {
        InspectorTest.sendCommand("Runtime.evaluate", { "expression": "aGlobalObject" }, didEvaluate3.bind(this, releasedObjectId));
    }
    function didEvaluate3(releasedObjectId, messageObject)
    {
        var objectId = messageObject.result.result.objectId;
        if (releasedObjectId === objectId) {
            InspectorTest.log("FAIL: object id is the same as was released");
            return InspectorTest.completeTest();
        } else
            InspectorTest.log("SUCCESS: evaluated to an object with id different from released one");
        InspectorTest.completeTest();
    }

}
</script>
</head>
<body onload="runTest()">
<p>Test that evaluating same object will result in same remote object id.<a href="https://bugs.webkit.org/show_bug.cgi?id=109908">Bug 109908.</p>
</body>
</html>

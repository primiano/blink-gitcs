<!DOCTYPE html>
<script src="../../js/resources/js-test-pre.js"></script>
<script src="testutils.js"></script>
<body>
<script>
if (fork()) {
    // The controlling parent frame
    description('Tests destroying a context during registration at the point when the prototype\'s constructor property is retrieved.');
    jsTestIsAsync = true;
    successfullyParsed = true;
} else {
    // The child frame

    var proto = Object.create(HTMLElement.prototype, {
      constructor: {
          get: function () {
              destroyContext();
              return HTMLElement;
          }
      }
    });

    try {
        document.register('x-a', {prototype: proto});
        log('FAIL expected register to throw an exception');
    } catch (ex) {
        log('PASS caught expected exception "' + ex + '"');
    }
    done();
}
</script>
<script src="../../js/resources/js-test-post.js"></script>
